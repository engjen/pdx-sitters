import React, { useState, useEffect } from 'react';
import { Calendar, User, DollarSign, Clock, Star, MapPin, Phone, Mail, Trash2, Check } from 'lucide-react';

export default function PDXSitters() {
  const [activeTab, setActiveTab] = useState('home');
  const [selectedSitter, setSelectedSitter] = useState(null);
  const [bookings, setBookings] = useState([]);
  const [sitters, setSitters] = useState([]);
  const [bookingForm, setBookingForm] = useState({
    sitterId: '',
    clientName: '',
    clientEmail: '',
    clientPhone: '',
    date: '',
    startTime: '',
    endTime: '',
    service: 'babysitting',
    notes: ''
  });

  // Load data from browser storage on mount
  useEffect(() => {
    const savedBookings = JSON.parse(localStorage.getItem('pdxBookings') || '[]');
    const savedSitters = JSON.parse(localStorage.getItem('pdxSitters') || '[]');
    
    setBookings(savedBookings);
    
    // If no sitters saved, use default sitters
    if (savedSitters.length === 0) {
      const defaultSitters = [
        {
          id: 1,
          name: "Your Name Here",
          photo: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=400&h=400&fit=crop",
          services: ['Babysitting', 'Pet Sitting'],
          experience: '5+ years',
          rate: '$25-35/hour',
          bio: 'Experienced childcare provider and pet lover. CPR certified, background checked. Available evenings and weekends.',
          rating: 5.0,
          reviews: 24,
          location: 'Portland, OR',
          phone: '(503) 555-0100',
          email: 'sitter1@pdxsitters.com'
        },
        {
          id: 2,
          name: "Sitter Name 2",
          photo: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&h=400&fit=crop",
          services: ['Babysitting'],
          experience: '3+ years',
          rate: '$20-30/hour',
          bio: 'Patient and creative babysitter specializing in toddlers and school-age children. Former preschool teacher.',
          rating: 4.9,
          reviews: 18,
          location: 'Portland, OR',
          phone: '(503) 555-0101',
          email: 'sitter2@pdxsitters.com'
        },
        {
          id: 3,
          name: "Sitter Name 3",
          photo: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=400&fit=crop",
          services: ['Pet Sitting', 'Dog Walking'],
          experience: '4+ years',
          rate: '$22-32/hour',
          bio: 'Passionate animal caregiver with experience handling dogs, cats, and small animals. Flexible schedule.',
          rating: 5.0,
          reviews: 31,
          location: 'Portland, OR',
          phone: '(503) 555-0102',
          email: 'sitter3@pdxsitters.com'
        }
      ];
      setSitters(defaultSitters);
      localStorage.setItem('pdxSitters', JSON.stringify(defaultSitters));
    } else {
      setSitters(savedSitters);
    }
  }, []);

  // Save bookings to storage whenever they change
  useEffect(() => {
    localStorage.setItem('pdxBookings', JSON.stringify(bookings));
  }, [bookings]);

  // Save sitters to storage whenever they change
  useEffect(() => {
    if (sitters.length > 0) {
      localStorage.setItem('pdxSitters', JSON.stringify(sitters));
    }
  }, [sitters]);

  const handleBookingSubmit = () => {
    if (!bookingForm.sitterId || !bookingForm.clientName || !bookingForm.clientEmail || 
        !bookingForm.clientPhone || !bookingForm.date || !bookingForm.startTime || !bookingForm.endTime) {
      alert('Please fill in all required fields');
      return;
    }

    const newBooking = {
      ...bookingForm,
      id: Date.now(),
      status: 'pending',
      fee: 15,
      createdAt: new Date().toISOString()
    };
    setBookings([...bookings, newBooking]);
    alert('Booking request submitted! The sitter will be notified.');
    setBookingForm({
      sitterId: '',
      clientName: '',
      clientEmail: '',
      clientPhone: '',
      date: '',
      startTime: '',
      endTime: '',
      service: 'babysitting',
      notes: ''
    });
    setActiveTab('bookings');
  };

  const deleteBooking = (id) => {
    if (confirm('Are you sure you want to delete this booking?')) {
      setBookings(bookings.filter(b => b.id !== id));
    }
  };

  const confirmBooking = (id) => {
    setBookings(bookings.map(b => 
      b.id === id ? {...b, status: 'confirmed'} : b
    ));
  };

  const totalRevenue = bookings.filter(b => b.status === 'confirmed').length * 15;

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
      {/* Header */}
      <header className="bg-white shadow-md sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-2">
              <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                <User className="w-6 h-6 text-white" />
              </div>
              <h1 className="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                PDX Sitters
              </h1>
            </div>
            <nav className="flex space-x-4 md:space-x-6 text-sm md:text-base">
              <button onClick={() => setActiveTab('home')} className={`${activeTab === 'home' ? 'text-purple-600 font-semibold' : 'text-gray-600 hover:text-purple-600'} transition`}>
                Home
              </button>
              <button onClick={() => setActiveTab('sitters')} className={`${activeTab === 'sitters' ? 'text-purple-600 font-semibold' : 'text-gray-600 hover:text-purple-600'} transition`}>
                Sitters
              </button>
              <button onClick={() => setActiveTab('book')} className={`${activeTab === 'book' ? 'text-purple-600 font-semibold' : 'text-gray-600 hover:text-purple-600'} transition`}>
                Book
              </button>
              <button onClick={() => setActiveTab('bookings')} className={`${activeTab === 'bookings' ? 'text-purple-600 font-semibold' : 'text-gray-600 hover:text-purple-600'} transition`}>
                Admin
              </button>
            </nav>
          </div>
        </div>
      </header>

      {/* Home Tab */}
      {activeTab === 'home' && (
        <div className="max-w-7xl mx-auto px-4 py-12">
          <div className="text-center mb-16">
            <h2 className="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
              Trusted Childcare & Pet Care in Portland
            </h2>
            <p className="text-lg md:text-xl text-gray-600 mb-8">
              Connect with experienced, background-checked sitters in your area
            </p>
            <button 
              onClick={() => setActiveTab('sitters')}
              className="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:shadow-lg transition transform hover:scale-105"
            >
              Find Your Perfect Sitter
            </button>
          </div>

          <div className="grid md:grid-cols-3 gap-8 mb-16">
            <div className="bg-white p-8 rounded-2xl shadow-lg text-center hover:shadow-xl transition">
              <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Star className="w-8 h-8 text-blue-600" />
              </div>
              <h3 className="text-xl font-bold mb-2">Vetted Professionals</h3>
              <p className="text-gray-600">All sitters are background checked and highly rated by local families</p>
            </div>
            <div className="bg-white p-8 rounded-2xl shadow-lg text-center hover:shadow-xl transition">
              <div className="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Calendar className="w-8 h-8 text-purple-600" />
              </div>
              <h3 className="text-xl font-bold mb-2">Easy Booking</h3>
              <p className="text-gray-600">Schedule care in minutes with our simple booking system</p>
            </div>
            <div className="bg-white p-8 rounded-2xl shadow-lg text-center hover:shadow-xl transition">
              <div className="w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Clock className="w-8 h-8 text-pink-600" />
              </div>
              <h3 className="text-xl font-bold mb-2">Flexible Scheduling</h3>
              <p className="text-gray-600">Find sitters for last-minute needs or regular care</p>
            </div>
          </div>

          <div className="bg-white rounded-2xl shadow-lg p-8">
            <h3 className="text-2xl font-bold mb-6">How It Works</h3>
            <div className="grid md:grid-cols-4 gap-6">
              <div className="text-center">
                <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-full flex items-center justify-center mx-auto mb-3 text-xl font-bold">1</div>
                <h4 className="font-semibold mb-2">Browse Sitters</h4>
                <p className="text-sm text-gray-600">Review profiles, rates, and availability</p>
              </div>
              <div className="text-center">
                <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-full flex items-center justify-center mx-auto mb-3 text-xl font-bold">2</div>
                <h4 className="font-semibold mb-2">Request Booking</h4>
                <p className="text-sm text-gray-600">Submit your care needs and schedule</p>
              </div>
              <div className="text-center">
                <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-full flex items-center justify-center mx-auto mb-3 text-xl font-bold">3</div>
                <h4 className="font-semibold mb-2">Get Confirmed</h4>
                <p className="text-sm text-gray-600">Sitter confirms and you're all set</p>
              </div>
              <div className="text-center">
                <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-full flex items-center justify-center mx-auto mb-3 text-xl font-bold">4</div>
                <h4 className="font-semibold mb-2">Enjoy Peace of Mind</h4>
                <p className="text-sm text-gray-600">Your loved ones are in great hands</p>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Sitters Tab */}
      {activeTab === 'sitters' && (
        <div className="max-w-7xl mx-auto px-4 py-12">
          <h2 className="text-4xl font-bold text-center mb-12">Our Trusted Sitters</h2>
          <div className="grid md:grid-cols-3 gap-8">
            {sitters.map(sitter => (
              <div key={sitter.id} className="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition transform hover:-translate-y-1">
                <img src={sitter.photo} alt={sitter.name} className="w-full h-64 object-cover" />
                <div className="p-6">
                  <h3 className="text-2xl font-bold mb-2">{sitter.name}</h3>
                  <div className="flex items-center mb-3">
                    <Star className="w-5 h-5 text-yellow-400 fill-current" />
                    <span className="ml-1 font-semibold">{sitter.rating}</span>
                    <span className="text-gray-500 ml-1">({sitter.reviews} reviews)</span>
                  </div>
                  <div className="flex items-center text-gray-600 mb-2">
                    <MapPin className="w-4 h-4 mr-1" />
                    <span className="text-sm">{sitter.location}</span>
                  </div>
                  <div className="mb-3">
                    {sitter.services.map(service => (
                      <span key={service} className="inline-block bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm mr-2 mb-2">
                        {service}
                      </span>
                    ))}
                  </div>
                  <p className="text-gray-600 mb-4">{sitter.bio}</p>
                  <div className="flex justify-between items-center">
                    <span className="text-lg font-bold text-purple-600">{sitter.rate}</span>
                    <button 
                      onClick={() => {
                        setSelectedSitter(sitter);
                        setBookingForm({...bookingForm, sitterId: sitter.id});
                        setActiveTab('book');
                      }}
                      className="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-2 rounded-full font-semibold hover:shadow-lg transition"
                    >
                      Book Now
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Booking Tab */}
      {activeTab === 'book' && (
        <div className="max-w-3xl mx-auto px-4 py-12">
          <div className="bg-white rounded-2xl shadow-lg p-8">
            <h2 className="text-3xl font-bold mb-6">Request a Booking</h2>
            <div className="space-y-6">
              <div>
                <label className="block text-sm font-semibold mb-2">Select Sitter *</label>
                <select 
                  value={bookingForm.sitterId}
                  onChange={(e) => setBookingForm({...bookingForm, sitterId: e.target.value})}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                  <option value="">Choose a sitter...</option>
                  {sitters.map(sitter => (
                    <option key={sitter.id} value={sitter.id}>{sitter.name} - {sitter.services.join(', ')}</option>
                  ))}
                </select>
              </div>

              <div className="grid md:grid-cols-2 gap-6">
                <div>
                  <label className="block text-sm font-semibold mb-2">Your Name *</label>
                  <input 
                    type="text" 
                    value={bookingForm.clientName}
                    onChange={(e) => setBookingForm({...bookingForm, clientName: e.target.value})}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-2">Email *</label>
                  <input 
                    type="email" 
                    value={bookingForm.clientEmail}
                    onChange={(e) => setBookingForm({...bookingForm, clientEmail: e.target.value})}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2">Phone *</label>
                <input 
                  type="tel" 
                  value={bookingForm.clientPhone}
                  onChange={(e) => setBookingForm({...bookingForm, clientPhone: e.target.value})}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2">Service Type</label>
                <select 
                  value={bookingForm.service}
                  onChange={(e) => setBookingForm({...bookingForm, service: e.target.value})}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                  <option value="babysitting">Babysitting</option>
                  <option value="petsitting">Pet Sitting</option>
                  <option value="both">Both</option>
                </select>
              </div>

              <div className="grid md:grid-cols-3 gap-6">
                <div>
                  <label className="block text-sm font-semibold mb-2">Date *</label>
                  <input 
                    type="date" 
                    value={bookingForm.date}
                    onChange={(e) => setBookingForm({...bookingForm, date: e.target.value})}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-2">Start Time *</label>
                  <input 
                    type="time" 
                    value={bookingForm.startTime}
                    onChange={(e) => setBookingForm({...bookingForm, startTime: e.target.value})}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-2">End Time *</label>
                  <input 
                    type="time" 
                    value={bookingForm.endTime}
                    onChange={(e) => setBookingForm({...bookingForm, endTime: e.target.value})}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2">Additional Notes</label>
                <textarea 
                  value={bookingForm.notes}
                  onChange={(e) => setBookingForm({...bookingForm, notes: e.target.value})}
                  rows="4"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  placeholder="Any special requirements or information for the sitter..."
                ></textarea>
              </div>

              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <p className="text-sm text-gray-700">
                  <strong>Booking Fee:</strong> A $15 service fee will be charged to the sitter upon confirmation of this booking.
                </p>
              </div>

              <button 
                onClick={handleBookingSubmit}
                className="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 rounded-lg text-lg font-semibold hover:shadow-lg transition transform hover:scale-105"
              >
                Submit Booking Request
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Admin Bookings Tab */}
      {activeTab === 'bookings' && (
        <div className="max-w-7xl mx-auto px-4 py-12">
          <div className="bg-white rounded-2xl shadow-lg p-8 mb-8">
            <h2 className="text-3xl font-bold mb-6">Booking Dashboard</h2>
            
            <div className="grid md:grid-cols-3 gap-6 mb-8">
              <div className="bg-gradient-to-br from-blue-500 to-purple-600 text-white p-6 rounded-xl">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-blue-100 mb-1">Total Bookings</p>
                    <p className="text-4xl font-bold">{bookings.length}</p>
                  </div>
                  <Calendar className="w-12 h-12 opacity-50" />
                </div>
              </div>
              <div className="bg-gradient-to-br from-green-500 to-emerald-600 text-white p-6 rounded-xl">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-green-100 mb-1">Revenue Earned</p>
                    <p className="text-4xl font-bold">${totalRevenue}</p>
                  </div>
                  <DollarSign className="w-12 h-12 opacity-50" />
                </div>
              </div>
              <div className="bg-gradient-to-br from-pink-500 to-rose-600 text-white p-6 rounded-xl">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-pink-100 mb-1">Confirmed</p>
                    <p className="text-4xl font-bold">{bookings.filter(b => b.status === 'confirmed').length}</p>
                  </div>
                  <Check className="w-12 h-12 opacity-50" />
                </div>
              </div>
            </div>

            <h3 className="text-xl font-bold mb-4">Recent Bookings</h3>
            {bookings.length === 0 ? (
              <p className="text-gray-500 text-center py-8">No bookings yet. They'll appear here when clients make requests.</p>
            ) : (
              <div className="space-y-4">
                {bookings.map(booking => {
                  const sitter = sitters.find(s => s.id === parseInt(booking.sitterId));
                  return (
                    <div key={booking.id} className="border border-gray-200 rounded-lg p-6 hover:shadow-md transition">
                      <div className="flex justify-between items-start mb-4">
                        <div>
                          <h4 className="text-lg font-bold">{booking.clientName}</h4>
                          <p className="text-gray-600">{sitter?.name} - {booking.service}</p>
                        </div>
                        <div className="flex items-center gap-2">
                          <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                            booking.status === 'confirmed' 
                              ? 'bg-green-100 text-green-700' 
                              : 'bg-yellow-100 text-yellow-700'
                          }`}>
                            {booking.status}
                          </span>
                          {booking.status === 'pending' && (
                            <button
                              onClick={() => confirmBooking(booking.id)}
                              className="p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
                              title="Confirm booking"
                            >
                              <Check className="w-4 h-4" />
                            </button>
                          )}
                          <button
                            onClick={() => deleteBooking(booking.id)}
                            className="p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition"
                            title="Delete booking"
                          >
                            <Trash2 className="w-4 h-4" />
                          </button>
                        </div>
                      </div>
                      <div className="grid md:grid-cols-2 gap-4 text-sm">
                        <div>
                          <p className="text-gray-600"><strong>Date:</strong> {booking.date}</p>
                          <p className="text-gray-600"><strong>Time:</strong> {booking.startTime} - {booking.endTime}</p>
                        </div>
                        <div>
                          <p className="text-gray-600"><strong>Email:</strong> {booking.clientEmail}</p>
                          <p className="text-gray-600"><strong>Phone:</strong> {booking.clientPhone}</p>
                        </div>
                      </div>
                      {booking.notes && (
                        <p className="text-gray-600 mt-4 text-sm"><strong>Notes:</strong> {booking.notes}</p>
                      )}
                      <div className="mt-4 pt-4 border-t border-gray-200">
                        <p className={`font-semibold ${booking.status === 'confirmed' ? 'text-green-600' : 'text-gray-500'}`}>
                          Booking Fee: ${booking.fee} {booking.status === 'confirmed' ? '(Earned)' : '(Pending)'}
                        </p>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      )}

      {/* Footer */}
      <footer className="bg-gray-800 text-white py-8 mt-16">
        <div className="max-w-7xl mx-auto px-4 text-center">
          <p className="mb-2">&copy; 2026 PDX Sitters. All rights reserved.</p>
          <p className="text-gray-400 text-sm">Trusted childcare and pet care services in Portland, OR</p>
        </div>
      </footer>
    </div>
  );
}